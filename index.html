<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chess Board with Pointer Events</title>
  <style>
    /* ===== 전체 레이아웃 ===== */
    body {
      margin: 0;
      padding: 0;
      background-color: #fafafa;
      font-family: Arial, sans-serif;
    }
    .chess-container {
      max-width: 800px; 
      width: 100%;
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box;
      background-color: #ffffff;
      min-height: 100vh;
    }
    .board-wrapper {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    /* ===== 체스 보드 (8x8) ===== */
    .chess-board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(8, 1fr);
      border: 2px solid #333;
      aspect-ratio: 1 / 1; /* 가로/세로 비율 1:1 */
    }
    .square {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative; /* 기물이 상대배치(absolute)로 들어올 수 있음 */
    }
    .dark {
      background-color: #769656;
    }
    .light {
      background-color: #eeeed2;
    }

    /* ===== 기물 스타일 ===== */
    .piece {
      width: 90%;
      height: 90%;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      position: relative;
      z-index: 1;
      margin: auto;
    }
    /* 각 기물별 배경 위치 */
    .piece.black.king { background-image: url('./images/pieces/bk.svg'); }
    .piece.black.queen { background-image: url('./images/pieces/bq.svg'); }
    .piece.black.rook { background-image: url('./images/pieces/br.svg'); }
    .piece.black.bishop { background-image: url('./images/pieces/bb.svg'); }
    .piece.black.knight { background-image: url('./images/pieces/bn.svg'); }
    .piece.black.pawn { background-image: url('./images/pieces/bp.svg'); }
    .piece.white.king { background-image: url('./images/pieces/wk.svg'); }
    .piece.white.queen { background-image: url('./images/pieces/wq.svg'); }
    .piece.white.rook { background-image: url('./images/pieces/wr.svg'); }
    .piece.white.bishop { background-image: url('./images/pieces/wb.svg'); }
    .piece.white.knight { background-image: url('./images/pieces/wn.svg'); }
    .piece.white.pawn { background-image: url('./images/pieces/wp.svg'); }
    /* 드래그 중 상태를 표시할 수도 있음 */
    .dragging {
      opacity: 0.8;
      cursor: grabbing;
    }
    /* 선택된 기물 표시 */
    .selected {
      outline: 3px solid rgba(255, 255, 0, 0.7); /* 노란색 테두리 */
      outline-offset: -3px; /* 테두리를 안쪽으로 */
    }
  </style>
</head>
<body>
  <div class="chess-container">
    <h1>체스 보드 테스트 (Pointer Events)</h1>
    <div class="board-wrapper">
      <div id="chessBoard" class="chess-board">
        <!-- JS로 8x8 칸 생성 + 각 칸에 Pawn 하나씩 배치 -->
      </div>
    </div>
  </div>

  <script>
    const board = document.getElementById('chessBoard');

    // 1) 8x8 칸 생성 + 각 칸에 폰(♙) 하나씩 배치
    for (let row = 8; row >= 1; row--) {
      for (let col = 1; col <= 8; col++) {
        const square = document.createElement('div');
        const isDark = (row + col) % 2 === 0;
        square.classList.add('square', isDark ? 'dark' : 'light');

        // 체스 초기 배치 구현
        if (row >= 6) {  // 위쪽 3줄에만 기물 배치
          const piece = document.createElement('div');
          piece.classList.add('piece');
          
          // 각 행별 기물 배치
          if (row === 8) {  // 첫 번째 줄 (흑)
            if (col === 1 || col === 8) {
              piece.classList.add('black', 'rook');
            } else if (col === 2 || col === 7) {
              piece.classList.add('black', 'knight');
            } else if (col === 3 || col === 6) {
              piece.classList.add('black', 'bishop');
            } else if (col === 4) {
              piece.classList.add('black', 'queen');
            } else if (col === 5) {
              piece.classList.add('black', 'king');
            }
          } else if (row === 7) {  // 두 번째 줄 (흑 폰)
            piece.classList.add('black', 'pawn');
          } else if (row === 6) {  // 세 번째 줄 (백 폰)
            piece.classList.add('white', 'pawn');
          }
          
          if (piece.classList.contains('black') || piece.classList.contains('white')) {
            square.appendChild(piece);
          }
        }

        board.appendChild(square);
      }
    }

    let selectedPiece = null;   // 현재 선택된 기물

    // 체스 보드 전체에 이벤트 위임
    board.addEventListener('pointerdown', onPointerDown);

    function onPointerDown(e) {
      const target = e.target;
      const targetSquare = target.closest('.square'); // 클릭된 칸 찾기

      if (!targetSquare) return; // 보드 바깥 클릭 무시

      if (selectedPiece) {
        // 기물이 이미 선택된 상태
        if (target.classList.contains('piece')) {
          // 다른 기물을 클릭한 경우
          if (target === selectedPiece) {
            // 같은 기물 클릭: 선택 해제
            selectedPiece.classList.remove('selected');
            selectedPiece = null;
          } else {
            // 다른 기물 클릭: 선택 변경
            selectedPiece.classList.remove('selected');
            selectedPiece = target;
            selectedPiece.classList.add('selected');
          }
        } else {
          // 빈 칸 또는 점유된 칸 클릭: 기물 이동
          targetSquare.appendChild(selectedPiece);
          selectedPiece.classList.remove('selected');
          selectedPiece = null;
        }
      } else {
        // 선택된 기물이 없는 상태
        if (target.classList.contains('piece')) {
          // 기물 클릭: 선택
          selectedPiece = target;
          selectedPiece.classList.add('selected');
        }
        // 빈 칸 클릭은 아무것도 안 함
      }
    }
  </script>
</body>
</html>
